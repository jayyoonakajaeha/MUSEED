@startuml
' C4 Container Diagram
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

' Layout
LAYOUT_WITH_LEGEND()

System_Boundary(museed_system, "MUSEED: AI-Powered Music Discovery Platform") {

    ' Frontend
    Container(frontend, "Frontend Web App", "Next.js / React / TypeScript", "Provides user interface for playlist creation, audio playback, and dashboard.", "react")

    ' Backend & Async Processing
    Container(backend, "Backend API", "FastAPI / Python", "Handles REST API requests, authentication, and serves static files.", "python")
    ContainerQueue(redis, "Message Broker", "Redis", "Queues AI generation tasks asynchronously.", "redis")
    Container(worker, "AI Worker", "Celery / PyTorch", "Background worker for audio analysis, embedding extraction, and playlist generation.", "python")

    ' Data Storage
    ContainerDb(postgres, "Main Database", "PostgreSQL", "Stores user profiles, playlist metadata, interactions (likes), and listening history.", "postgresql")
    ContainerDb(faiss, "Vector Index", "FAISS (In-Memory/File)", "High-dimensional vector index for fast similarity search (IVF/Flat).", "server")
    ContainerDb(filestore, "File Storage", "Local Filesystem", "Stores raw audio files (FMA/Jamendo), album art, and user profile images.", "folder")

    ' Relationships
    Rel(frontend, backend, "API Calls (JSON)", "HTTP/HTTPS")
    Rel(frontend, backend, "Stream Audio", "HTTP")

    Rel(backend, postgres, "Reads/Writes Data", "SQL (SQLAlchemy)")
    Rel(backend, redis, "Enqueues AI Tasks", "Redis Protocol")
    
    Rel(redis, worker, "Consumes Tasks", "Redis Protocol")
    Rel(worker, faiss, "Queries/Updates Index", "Vector Search")
    Rel(worker, filestore, "Reads Audio/Embeddings", "File IO")
    Rel(worker, postgres, "Updates Playlist Results", "SQL")

    Rel(backend, filestore, "Reads/Serves Media", "File IO")

    ' External User
    Person(user, "User", "Music listener & Creator")
    Rel(user, frontend, "Interacts with", "Web Browser")
}
@enduml